---
- hosts: all
  vars:
    ceph_globals_vars: "{{ playbook_dir }}/globals.yml"
  gather_facts: false
  tasks:
  - name: "include {{ ceph_globals_vars }} file"
    include_vars:
        file: "{{ ceph_globals_vars }}"
    tags:
      - always

  - name: Setup host vars
    setup:
      filter: "{{ item }}"
    register: hostinfo
    with_items:
      - "ansible_hostname"
      - "ansible_devices"
      - "ansible_{{ storage_interface }}"
      - "ansible_{{ cluster_interface }}"
    tags: always

  - name: Set_fact host vars
    set_fact: host_vars={{ hostinfo.results }}
    tags: always

  - name: Optimization OS
    import_role: 
      name: hosts
    tags:
      - hosts

  - name: Create ceph-mon 
    import_role: 
      name: ceph-mon
    tags:
      - always

  - name: Create ceph-mgr
    import_role:
      name: ceph-mgr
    tags:
      - ceph-mgr

  - name: Create ceph-osd
    import_role:
      name: ceph-osd
    tags:
      - ceph-osd

  - name: Create ceph-rgw
    import_role:
      name: ceph-rgw
    tags:
      - ceph-rgw

  - name: Create ceph-mds
    import_role:
      name: ceph-mds
    tags:
      - ceph-mds

